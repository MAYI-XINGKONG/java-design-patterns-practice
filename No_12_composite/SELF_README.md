# ç»„åˆæ¨¡å¼(Composite Pattern)å®è·µæ€»ç»“ä¸å­¦ä¹ æŒ‡å—
**ä½œè€…ï¼š@niudada**  
**æ—¶é—´ï¼š2025å¹´7æœˆ**

---

## ä¸€ã€ç»„åˆæ¨¡å¼çš„æ ¸å¿ƒï¼šç»Ÿä¸€æ€§

ç»„åˆæ¨¡å¼çš„æ ¸å¿ƒåœ¨äºï¼š
- æŠ½è±¡å‡ºä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æˆ–æŠ½è±¡ç±»
- å¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹éƒ½å®ç°è¯¥æ¥å£
- ç»„åˆèŠ‚ç‚¹ç»´æŠ¤å­èŠ‚ç‚¹é›†åˆ,å¹¶é€’å½’è°ƒç”¨
- å®¢æˆ·ç«¯æ— éœ€å…³å¿ƒå…·ä½“ç±»å‹,ç»Ÿä¸€å¤„ç†

> **ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ— éœ€åŒºåˆ†å¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹,ç»Ÿä¸€è°ƒç”¨æ¥å£å³å¯**

è¿™ç§ç»Ÿä¸€æ€§åœ¨å¾ˆå¤šç³»ç»Ÿä¸­éƒ½å­˜åœ¨ï¼š

- æ–‡ä»¶ç³»ç»Ÿï¼šç›®å½•åŒ…å«ç›®å½•å’Œæ–‡ä»¶
- èœå•ç³»ç»Ÿï¼šèœå•ç»„åŒ…å«èœå•ç»„å’Œèœå•é¡¹
- å®¡æ‰¹æµç¨‹ï¼šå®¡æ‰¹ç»„åŒ…å«å®¡æ‰¹ç»„å’Œå®¡æ‰¹èŠ‚ç‚¹
- API è·¯ç”±ï¼šæœåŠ¡åŒ…å«æœåŠ¡ã€ç»„ã€æ¥å£
- è¡Œä¸ºæ ‘ï¼šè¡Œä¸ºèŠ‚ç‚¹åŒ…å«åºåˆ—ã€é€‰æ‹©ã€åŠ¨ä½œ

è¿™äº›ç»“æ„éƒ½å…·æœ‰**éƒ¨åˆ†-æ•´ä½“**çš„ç‰¹æ€§,è€Œç»„åˆæ¨¡å¼æ­£é€‚åˆè¿™ç§ç»“æ„

---

## äºŒã€Demoæ€»ç»“

### 1. **æŠ½è±¡ç±»æ˜¯ç»„åˆæ¨¡å¼çš„éª¨æ¶**

åœ¨è¿™äº› Demoä¸­,æˆ‘éƒ½ä½¿ç”¨äº†æŠ½è±¡ç±»ä½œä¸ºç»Ÿä¸€æ¥å£,æ¯”å¦‚ï¼š

| æŠ½è±¡ç±» | ä½œç”¨ |
|--------|------|
| [FileSystemNode](src/main/java/com/niudada/level1/filesystem/FileSystemNode.java) | æ–‡ä»¶ç³»ç»Ÿç»Ÿä¸€æ¥å£ |
| [MenuComponent](src/main/java/com/niudada/level2/multilevelmenu/MenuComponent.java) | èœå•ç³»ç»Ÿç»Ÿä¸€æ¥å£ |
| [BehaviorNode](src/main/java/com/niudada/level2/aibehaviortree/BehaviorNode.java) | è¡Œä¸ºæ ‘ç»Ÿä¸€æ¥å£ |
| [ApprovalComponent](src/main/java/com/niudada/level3/approvalflow/ApprovalComponent.java) | å®¡æ‰¹æµç¨‹ç»Ÿä¸€æ¥å£ |
| [ApiComponent](src/main/java/com/niudada/level3/apirouter/ApiComponent.java) | API è·¯ç”±ç»Ÿä¸€æ¥å£ |

å› ä¸ºæŠ½è±¡ç±»å¯ä»¥å®šä¹‰ç»Ÿä¸€çš„è¡Œä¸º,æ¯”å¦‚ï¼š

```java
// `indent`ä¸ç”¨è¿‡åˆ†å…³æ³¨,åªæ˜¯ä¸ºäº†å±•ç¤ºå‡ºæ ‘å½¢ç»“æ„è€Œå·²
public abstract void print(String indent);
public abstract void execute(String indent);
public abstract boolean approve(ApprovalContext context, String indent);
```

è¿™äº›æ–¹æ³•æ„æˆäº†ç»„åˆæ¨¡å¼çš„`"ç»Ÿä¸€è¡Œä¸º"`

---

### 2. **å¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹çš„èŒè´£**

ç»„åˆæ¨¡å¼çš„ä¸¤ä¸ªæ ¸å¿ƒè§’è‰²æ˜¯ï¼š

- **å¶å­èŠ‚ç‚¹(Leaf)**ï¼šæ‰§è¡Œå…·ä½“é€»è¾‘,ä¸èƒ½æ·»åŠ å­èŠ‚ç‚¹
- **ç»„åˆèŠ‚ç‚¹(Composite)**ï¼šç»´æŠ¤å­èŠ‚ç‚¹é›†åˆ,é€’å½’è°ƒç”¨å­èŠ‚ç‚¹

ä¾‹å¦‚ï¼š

- [File](src/main/java/com/niudada/level1/filesystem/File.java) æ˜¯å¶å­èŠ‚ç‚¹,ä¸èƒ½æ·»åŠ å­èŠ‚ç‚¹
- [Directory](src/main/java/com/niudada/level1/filesystem/Directory.java) æ˜¯ç»„åˆèŠ‚ç‚¹,å¯ä»¥æ·»åŠ å­èŠ‚ç‚¹å¹¶é€’å½’æ‰“å°

è¿™ç§èŒè´£åˆ’åˆ†å¾ˆæ¸…æ™°,æ˜¯ç»„åˆæ¨¡å¼ç»“æ„ç¨³å®šçš„å…³é”®

---

### 3. **ç»„åˆç»“æ„çš„é€’å½’è°ƒç”¨**

> æé†’ï¼šé€’å½’è°ƒç”¨ä¸å½“å®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡ºå’Œæ³„éœ²,æ‰€ä»¥ä½¿ç”¨éœ€è¦è°¨æ…

ç»„åˆæ¨¡å¼çš„å…³é”®åœ¨äºé€’å½’è°ƒç”¨,æ¯”å¦‚ï¼š

```java
public void print(String indent) {
    System.out.println(indent + "ğŸ“ ç›®å½•ï¼š" + name);
    for (var child : children) {
        child.print(indent + "  ");
    }
}
```


åªè¦è°ƒç”¨é¡¶å±‚èŠ‚ç‚¹çš„ [print()](src/main/java/com/niudada/level1/filesystem/FileSystemNode.java) æ–¹æ³•,æ•´ä¸ªç»“æ„å°±ä¼šè¢«é€’å½’éå†,å®¢æˆ·ç«¯ä¸ç”¨å…³å¿ƒç»“æ„æ·±åº¦

---

### 4. **ç»„åˆæ¨¡å¼ä¸æ˜¯ä¸‡èƒ½**

è™½ç„¶ç»„åˆæ¨¡å¼å¾ˆå¼ºå¤§,ä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰ç»“æ„éƒ½é€‚åˆç”¨å®ƒå¤„ç†, æ¯”å¦‚ï¼š èŠ‚ç‚¹è¡Œä¸ºå·®å¼‚è¾ƒå¤§ã€æˆ–è€…ç»“æ„ç®€å•å±‚æ¬¡å°‘çš„

å¦å¤–ä¹Ÿæœ‰æ¯”è¾ƒé€‚åˆç»„åˆæ¨¡å¼çš„åœºæ™¯ï¼š

- éœ€è¦å¤„ç†æ ‘å½¢ç»“æ„ã€åµŒå¥—ç»“æ„
- éœ€è¦ç»Ÿä¸€å¤„ç†å¶å­å’Œç»„åˆ
- éœ€è¦é€’å½’æ“ä½œ
- éœ€è¦åŠ¨æ€æ„å»ºç»“æ„

æ³¨æ„ï¼šç»„åˆæ¨¡å¼ä¸æ˜¯ä¸‡èƒ½çš„,å®ƒéœ€è¦æ ¹æ®å…·ä½“åœºæ™¯æ¥é€‰æ‹©ä½¿ç”¨,ä½¿ç”¨ä¸å½“ä¹Ÿå¯èƒ½ä¼šå¢åŠ å¤æ‚åº¦,è®©ä»£ç æ˜¾å¾—å†—ä½™

---

### 5. **ç»„åˆæ¨¡å¼çš„ä½¿ç”¨å»ºè®®**

- å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨`éƒ¨åˆ†-æ•´ä½“`å…³ç³»æ—¶,å¯ä»¥è€ƒè™‘ç»„åˆæ¨¡å¼
- è®¾è®¡ç»„ä»¶æ¥å£æ—¶,è¦ç»Ÿä¸€å¶å­å’Œç»„åˆçš„è¡Œä¸º,é¿å…å‡ºç°å¤§é‡ `instanceof`åˆ¤æ–­
- é¿å…æ»¥ç”¨,å¦‚æœç»“æ„ç®€å•,ç”¨ç»„åˆæ¨¡å¼åè€Œä¼šå¢åŠ å¤æ‚åº¦
- æ³¨æ„ç©ºæ“ä½œå¤„ç†,å¦‚`add/remove`æ–¹æ³•åœ¨å¶å­èŠ‚ç‚¹ä¸­åº”æŠ›å‡ºå¼‚å¸¸æˆ–è€…ä¸å®ç°
- ç»“åˆå…¶ä»–æ¨¡å¼ä½¿ç”¨,ç»„åˆæ¨¡å¼ä¸æ˜¯å­¤ç«‹çš„,å®ƒé€‚åˆä¸å…¶ä»–æ¨¡å¼ç»“åˆä½¿ç”¨,æ„å»ºæ›´å¤æ‚çš„ç³»ç»Ÿ

---

## ä¸‰ã€ç»„åˆæ¨¡å¼ä¸å…¶ä»–æ¨¡å¼
### 1.**å¯¹æ¯”**
| æ¨¡å¼ | åŒºåˆ«                                |
|----|-----------------------------------|
|è£…é¥°å™¨æ¨¡å¼| ç»„åˆæ˜¯ç»“æ„æ ‘,è£…é¥°å™¨æ˜¯è¡Œä¸ºé“¾;ç»„åˆç”¨äºç»„åˆç»“æ„,è£…é¥°å™¨ç”¨äºå¢å¼ºåŠŸèƒ½ |
|èŒè´£é“¾æ¨¡å¼| ç»„åˆæ˜¯é™æ€ç»“æ„,èŒè´£é“¾æ˜¯åŠ¨æ€å¤„ç†æµç¨‹                |
|è¿­ä»£å™¨æ¨¡å¼| ç»„åˆä¸­é€šå¸¸åŒ…å«é›†åˆ,è¿­ä»£å™¨ç”¨äºéå†è¿™äº›é›†åˆ             |
|ç­–ç•¥æ¨¡å¼| ç»„åˆæ˜¯ç»“æ„,ç­–ç•¥æ˜¯è¡Œä¸ºé€‰æ‹©                     |

### 2.**ç»“åˆ**
| ç»„åˆæ¨¡å¼ | å…¶ä»–æ¨¡å¼ | ç”¨é€” |
|----|------|----|
|æ–‡ä»¶ç³»ç»Ÿ| ç­–ç•¥æ¨¡å¼ |ä¸åŒå¹³å°çš„æ¸²æŸ“ç­–ç•¥|
|èœå•ç³»ç»Ÿ| æ„å»ºå™¨æ¨¡å¼ |æ›´æ¸…æ™°çš„æ„å»ºæ–¹å¼|
|å®¡æ‰¹æµç¨‹| çŠ¶æ€æ¨¡å¼ |å®¡æ‰¹ä¸­æ–­ã€ç»§ç»­ã€å¤±è´¥|

---

## å››ã€æˆ‘çš„ä¸€ç‚¹æ„Ÿæ‚Ÿ

> ç»„åˆæ¨¡å¼ä¸æ˜¯æœ€éš¾çš„æ¨¡å¼,ä½†å´æ˜¯æœ€å®ç”¨çš„æ¨¡å¼ä¹‹ä¸€

> **å®ƒçš„ä»·å€¼åœ¨äºå®ƒèƒ½å¸®ä½ æ„å»ºå‡ºç»“æ„æ¸…æ™°ã€é€»è¾‘ç»Ÿä¸€ã€æ˜“äºç»´æŠ¤çš„ç³»ç»Ÿ**

> **å®ƒçš„éš¾ç‚¹ä¸åœ¨äºå†™,è€Œåœ¨äº"ä½•æ—¶ç”¨"å’Œ"æ€ä¹ˆç”¨",è¿™ä¹Ÿæ˜¯è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªéš¾ç‚¹**

---

## äº”ã€ç»„åˆæ¨¡å¼è®¾è®¡æ¨¡æ¿(ä»…ä¾›å‚è€ƒ)

```java
// æŠ½è±¡ç»„ä»¶
public abstract class Component {
    public abstract void operation();
    public void add(Component c) { throw new UnsupportedOperationException(); }
    public void remove(Component c) { throw new UnsupportedOperationException(); }
    public List<Component> getChildren() { throw new UnsupportedOperationException(); }
}

// å¶å­èŠ‚ç‚¹
public class Leaf extends Component {
    @Override
    public void operation() {
        // å®ç°å…·ä½“é€»è¾‘
    }
}

// ç»„åˆèŠ‚ç‚¹
public class Composite extends Component {
    private List<Component> children = new ArrayList<>();

    @Override
    public void operation() {
        for (Component child : children) {
            child.operation();
        }
    }

    @Override
    public void add(Component c) {
        children.add(c);
    }

    @Override
    public void remove(Component c) {
        children.remove(c);
    }

    @Override
    public List<Component> getChildren() {
        return children;
    }
}
```


---

## å…­ã€æ„Ÿè°¢

æ„Ÿè°¢ä½ èŠ±æ—¶é—´é˜…è¯»è¿™äº›å†…å®¹,ä¹Ÿæ„Ÿè°¢ä½ æ„¿æ„å»å°è¯•ã€å»å®è·µã€å»æ€è€ƒ

> **æˆ‘åªæ˜¯ä¸€ä¸ªæ™®é€šçš„å¼€å‘è€…,å†™äº†ä¸€äº›æ™®é€šçš„ Demo,å¸Œæœ›å®ƒä»¬èƒ½å¸®åˆ°ä½ **

å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ã€å»ºè®®æˆ–æ”¹è¿›,æ¬¢è¿éšæ—¶äº¤æµ